dist: xenial
sudo: required

services:
  - docker

before_install:
- docker pull makeappdev/uselatex
- docker run -d -p 127.0.0.1:80:4567 makeappdev/uselatex /bin/sh -c "cd /root/makeappdev; bundle exec foreman start;"
- docker ps -a
- docker run makeappdev/uselatex /bin/sh -c "cmake --version; pdflatex --version"

script:
- docker run makeappdev/uselatex /bin/sh -c "mkdir -p build"
- docker run makeappdev/uselatex /bin/sh -c "cd build && cmake ..; make; cd .."
- docker run makeappdev/uselatex /bin/sh -c "mkdir -p export && cp build/*.pdf build/git.id export"
- docker run makeappdev/uselatex /bin/sh -c "echo "# This branch is for deployment only" >> export/README.md"
- docker cp -r makeappdev/uselatex:/export . 

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN  # Set in travis-ci.org dashboard, marked secure
  local-dir: export
  on:
    branch: master

notifications:
  email: false
